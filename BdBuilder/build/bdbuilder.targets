<?xml version="1.0" encoding="utf-8" ?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

	<PropertyGroup>
		<BdBuilderFileExe>dotnet &quot;$(MSBuildThisFileDirectory)../lib/netcoreapp2.0/dotnet-bdbuilder.dll&quot; &quot;$(ProjectDir)&quot;</BdBuilderFileExe>
		<QuoteRootNamespace>$(RootNameSpace)</QuoteRootNamespace>
	</PropertyGroup>

  <PropertyGroup>

    <OurTaskFolder Condition=" '$(MSBuildRuntimeType)' == 'Core' ">netstandard1.6</OurTaskFolder>
    <OurTaskFolder Condition=" '$(MSBuildRuntimeType)' != 'Core' ">net46</OurTaskFolder>
    <TaskAssembly>$(MSBuildThisFileDirectory)..\tasks\$(OurTaskFolder)\dotnet-bdbuilder.dll</TaskAssembly>
  </PropertyGroup>

  <UsingTask TaskName="BdBuilder.SayHello" AssemblyFile="$(TaskAssembly)" />

  <ItemGroup>
    <FeatureFiles Include="**\*.feature" />
  </ItemGroup>
  
  <Target Name="SayHello" BeforeTargets="CoreCompile" DependsOnTargets="PrepareForBuild"
          Inputs="@(FeatureFiles)" Outputs="@(FeatureFiles->'%(FullPath).cs')">

    <SayHello FileName="%(FeatureFiles.FullPath)" RootNameSpace="$(RootNameSpace)">
      <Output TaskParameter="OutputFile" ItemName="OutputFile" />
    </SayHello>

  </Target>

  <ItemGroup>
    <Content Include="**\*.feature" />
  </ItemGroup>

  <ItemGroup>
    <Compile Include="**\*.feature.cs" Condition=" '$(MSBuildRuntimeType)' != 'Core' " />
  </ItemGroup>

  <ItemGroup>
    <AvailableItemName Include="MyBuildAction" />
  </ItemGroup>
</Project>